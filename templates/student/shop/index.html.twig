{% extends 'student_layout.html.twig' %}

{% block title %}Boutique - EduSmart{% endblock %}

{% block body %}
<div style="margin-bottom: 40px;">
    <h2 style="font-size: 1.8rem; font-weight: 800; color: #1E293B; margin-bottom: 10px;">Boutique Éducative</h2>
    <p style="color: #64748B;">Équipez-vous pour réussir vos études.</p>
</div>

<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px;">
    {% for product in products %}
        <div class="card" style="display: flex; flex-direction: column; transition: 0.3s; border: 1px solid #F1F5F9; background: white; padding: 20px; border-radius: 20px;" 
             onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='0 10px 15px -3px rgba(0,0,0,0.1)'" 
             onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
            
            {# ZONE IMAGE CORRIGÉE #}
            <div style="height: 200px; background: #F8FAFC; border-radius: 15px; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; overflow: hidden; border: 1px solid #F1F5F9;">
                {% if product.image %}
                    <img src="{{ asset('uploads/produit/' ~ product.image) }}" 
                         alt="{{ product.name }}" 
                         style="width: 100%; height: 100%; object-fit: cover;"
                         onerror="this.onerror=null; this.src='https://placehold.co/600x400?text=Image+Introuvable';">
                {% else %}
                    <i class="fas fa-book-reader" style="font-size: 3.5rem; opacity: 0.2; color: #3B49A2;"></i>
                {% endif %}
            </div>

            <h4 style="font-size: 1.1rem; font-weight: 700; margin-bottom: 8px; color: #1E293B;">{{ product.name }}</h4>
            <p style="font-weight: 800; color: #6366F1; font-size: 1.3rem; margin-bottom: 20px;">{{ product.price|number_format(2, ',', ' ') }} €</p>
            
            <button class="btn btn-primary add-to-cart" 
                    data-id="{{ product.id }}" 
                    data-name="{{ product.name }}" 
                    data-price="{{ product.price }}"
                    style="width: 100%; padding: 12px; border-radius: 12px; background: #3B49A2; border: none; color: white; font-weight: 700; cursor: pointer;">
                <i class="fas fa-cart-plus" style="margin-right: 8px;"></i> Ajouter au panier
            </button>
        </div>
    {% endfor %}
</div>
{% endblock %}

{% block javascripts %}
<script>
    document.querySelectorAll('.add-to-cart').forEach(button => {
        button.addEventListener('click', function() {
            const product = {
                id: this.dataset.id,
                name: this.dataset.name,
                price: parseFloat(this.dataset.price)
            };
            
            let cart = JSON.parse(localStorage.getItem('edusmart_cart') || '[]');
            cart.push(product);
            localStorage.setItem('edusmart_cart', JSON.stringify(cart));
            
            // Si tu as une fonction updateCartCount() dans ton layout, elle sera appelée ici
            if (typeof updateCartCount === "function") {
                updateCartCount();
            }
            
            // Visual feedback
            const originalText = this.innerHTML;
            const originalBG = this.style.background;
            
            this.innerHTML = '<i class="fas fa-check"></i> Ajouté !';
            this.style.background = '#10B981';
            
            setTimeout(() => {
                this.innerHTML = originalText;
                this.style.background = originalBG;
            }, 2000);
        });
    });
</script>
{% endblock %}