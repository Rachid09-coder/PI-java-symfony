{% extends 'admin_layout.html.twig' %}

{% block title %}Dashboard Professeur - EduSmart{% endblock %}

{% block body %}
<div style="margin-bottom: 40px;">
    <h2 style="font-size: 1.8rem; font-weight: 800; color: #1E293B;">Bienvenue, Professeur</h2>
    <p style="color: #64748B;">Gérez vos élèves et vos contenus pédagogiques.</p>
</div>

<!-- Stats Grid -->
<div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 25px; margin-bottom: 40px;">
    <div class="card" style="padding: 25px; border-left: 4px solid #6366F1;">
        <p style="color: #64748B; font-size: 0.85rem; font-weight: 700; text-transform: uppercase; margin-bottom: 10px;">Élèves</p>
        <h3 style="font-size: 1.8rem; font-weight: 800;">{{ stats.total_students }}</h3>
    </div>
    <div class="card" style="padding: 25px; border-left: 4px solid #3B49A2;">
        <p style="color: #64748B; font-size: 0.85rem; font-weight: 700; text-transform: uppercase; margin-bottom: 10px;">Cours</p>
        <h3 style="font-size: 1.8rem; font-weight: 800;">{{ stats.total_courses }}</h3>
    </div>
    <div class="card" style="padding: 25px; border-left: 4px solid #F59E0B;">
        <p style="color: #64748B; font-size: 0.85rem; font-weight: 700; text-transform: uppercase; margin-bottom: 10px;">Examens</p>
        <h3 style="font-size: 1.8rem; font-weight: 800;">{{ stats.total_exams }}</h3>
    </div>
    <div class="card" style="padding: 25px; border-left: 4px solid #10B981;">
        <p style="color: #64748B; font-size: 0.85rem; font-weight: 700; text-transform: uppercase; margin-bottom: 10px;">Revenus</p>
        <h3 style="font-size: 1.8rem; font-weight: 800;">{{ stats.revenue }}</h3>
    </div>
</div>

<!-- Students Management -->
<div class="card" style="padding: 30px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <h3 style="font-size: 1.3rem; font-weight: 800; color: #1E293B;">Gestion des Élèves</h3>
        <a href="{{ path('app_register') }}" class="btn btn-primary" style="background: #3B49A2; border-radius: 10px; font-size: 0.85rem; text-decoration: none; display: inline-flex; align-items: center;">+ Inscrire un Élève</a>
    </div>

    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="text-align: left; border-bottom: 2px solid #F1F5F9; color: #94A3B8; font-size: 0.8rem; text-transform: uppercase;">
                <th style="padding: 15px;">Élève</th>
                <th style="padding: 15px;">Email</th>
                <th style="padding: 15px;">Date d'inscription</th>
                <th style="padding: 15px;">Statut</th>
                <th style="padding: 15px; text-align: right;">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for s in students %}
                {% set initials = (s.prenom|default('')|slice(0,1) ~ s.name|default('')|slice(0,1))|upper %}

                <tr style="border-bottom: 1px solid #F8FAFC;">
                    <td style="padding: 15px; display: flex; align-items: center; gap: 12px;">
                        <div style="width: 35px; height: 35px; border-radius: 50%; background: #DBEAFE; display: flex; align-items: center; justify-content: center; color: #3B49A2; font-weight: 700; font-size: 0.8rem;">
                            {{ initials }}
                        </div>
                        <span style="font-weight: 700;">{{ s.prenom }} {{ s.name }}</span>
                    </td>

                    <td style="padding: 15px; color: #64748B;">{{ s.email }}</td>

                    <td style="padding: 15px; color: #64748B;">
                        {% if s.createdAt is defined and s.createdAt %}
                            {{ s.createdAt|date('d/m/Y') }}
                        {% else %}
                            -
                        {% endif %}
                    </td>

                    <td style="padding: 15px;">
                        <span style="background: #D1FAE5; color: #10B981; padding: 4px 10px; border-radius: 20px; font-size: 0.7rem; font-weight: 700;">
                            Actif
                        </span>
                    </td>

                    <td style="padding: 15px; text-align: right;">
                        <a href="{{ path('admin_student_edit', {id: s.id}) }}"
                           class="btn btn-outline"
                           style="padding: 6px 10px; border-radius: 8px; color: #64748B;"
                           title="Modifier l'élève">
                            <i class="fas fa-edit"></i>
                        </a>

                        <form method="post"
                             action="{{ path('admin_student_delete', {id: s.id}) }}"
                              style="display:inline;"
                              onsubmit="return confirm('Supprimer cet élève ?');"
                              novalidate>
                            <input type="hidden" name="_token" value="{{ csrf_token('delete_student_' ~ s.id) }}">

                            <button type="submit"
                                    class="btn btn-outline"
                                    style="padding: 6px 10px; border-radius: 8px; color: #EF4444; background: transparent; border: 0; cursor: pointer; pointer-events: auto;"
                                    title="Supprimer l'élève">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="5" style="padding: 20px; color: #64748B;">
                        Aucun élève pour le moment.
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
