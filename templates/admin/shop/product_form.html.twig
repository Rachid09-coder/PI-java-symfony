{% extends 'admin_layout.html.twig' %}

{% block title %}Gestion Boutique - EduSmart{% endblock %}

{% block body %}
<div style="padding: 20px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <div>
            <h2 style="font-size: 1.8rem; font-weight: 800; color: #1E293B;">Produits en vente</h2>
            <p style="color: #64748B;">Gérez votre catalogue et vos stocks.</p>
        </div>
        <a href="{{ path('admin_shop_product_new') }}" style="background: #3B49A2; color: white; padding: 12px 25px; border-radius: 12px; text-decoration: none; font-weight: 600;">
            <i class="fas fa-plus"></i> Nouveau Produit
        </a>
    </div>

    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px;">
        {% for product in products %}
            <div style="background: white; border-radius: 20px; border: 1px solid #F1F5F9; padding: 20px; position: relative; transition: 0.3s;">
                
                {# ZONE IMAGE #}
                <div style="height: 180px; background: #F8FAFC; border-radius: 15px; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; overflow: hidden; border: 1px solid #F1F5F9;">
                    {% if product.image %}
                        {# Le chemin concaténé correctement #}
                        <img src="{{ asset('uploads/produit/' ~ product.image) }}" 
                             alt="{{ product.name }}" 
                             style="width: 100%; height: 100%; object-fit: cover;"
                             onerror="this.onerror=null; this.src='https://placehold.co/600x400?text=Image+Introuvable';">
                    {% else %}
                        <div style="text-align: center; color: #CBD5E1;">
                            <i class="fas fa-image" style="font-size: 3rem;"></i>
                            <p style="font-size: 0.8rem;">Aucune image</p>
                        </div>
                    {% endif %}
                </div>

                {# INFOS #}
                <div style="margin-bottom: 20px;">
                    <span style="font-size: 0.75rem; color: #6366F1; background: #EEF2FF; padding: 4px 8px; border-radius: 6px; font-weight: 600;">
                        {{ product.category ? product.category.name : 'Sans catégorie' }}
                    </span>
                    <h4 style="font-size: 1.1rem; margin-top: 8px; font-weight: 700; color: #1E293B;">{{ product.name }}</h4>
                    <p style="font-size: 1.2rem; font-weight: 800; color: #3B49A2; margin: 10px 0;">{{ product.price }} €</p>
                    <p style="font-size: 0.85rem; color: {{ product.stock > 5 ? '#10B981' : '#EF4444' }};">
                        Stock : {{ product.stock }} unités
                    </p>
                </div>

                {# ACTIONS #}
                <div style="display: flex; gap: 10px; border-top: 1px solid #F1F5F9; padding-top: 15px;">
                    <a href="{{ path('admin_shop_product_edit', {id: product.id}) }}" style="flex: 1; text-align: center; padding: 10px; background: #F8FAFC; border-radius: 8px; text-decoration: none; color: #1E293B; font-weight: 600; font-size: 0.9rem;">
                        <i class="fas fa-edit"></i> Modifier
                    </a>
                    
                    <form method="post" action="{{ path('admin_shop_product_delete', {id: product.id}) }}" style="flex: 1;" onsubmit="return confirm('Supprimer ce produit ?');">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ product.id) }}">
                        <button style="width: 100%; padding: 10px; background: #FFF1F2; border-radius: 8px; border: none; color: #E11D48; font-weight: 600; font-size: 0.9rem; cursor: pointer;">
                            <i class="fas fa-trash"></i> Supprimer
                        </button>
                    </form>
                </div>
            </div>
        {% else %}
            <div style="grid-column: 1/-1; text-align: center; padding: 50px; background: #F8FAFC; border-radius: 20px;">
                <p style="color: #64748B;">Votre boutique est vide pour le moment.</p>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}