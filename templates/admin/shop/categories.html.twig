{% extends 'admin_layout.html.twig' %}

{% block title %}Gérer les Catégories - EduSmart{% endblock %}

{% block body %}
<div style="max-width: 800px; margin: 0 auto;">
  <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 30px;">
    {# Lien de retour #}
    <a href="{{ path('admin_shop_index') }}" style="color: #64748B;"><i class="fas fa-arrow-left"></i></a>
    <h2 style="font-size: 1.5rem; font-weight: 800;">Gestion des Catégories</h2>
  </div>

  <div style="display: grid; grid-template-columns: 1fr 1.5fr; gap: 30px;">
    
    <div class="card" style="padding: 25px; height: fit-content; background: #fff; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
      <h3 style="font-size: 1.1rem; font-weight: 800; margin-bottom: 20px;">Nouvelle Catégorie</h3>

      {# Début du formulaire Symfony #}
      {{ form_start(form) }}
      
        {# Champ Couleur (Caché mais connecté à Symfony) #}
       {{ form_widget(form.color, {
    'id': 'color-input', 
    'attr': {
        'value': '#6366F1',
        'type': 'hidden' 
    } 
}) }}
        {# Champ NOM #}
        <div style="margin-bottom: 15px;">
          <label style="display: block; font-weight: 700; margin-bottom: 8px; font-size: 0.85rem;">Nom de la catégorie</label>
          {{ form_widget(form.name, {
              'attr': {
                  'placeholder': 'Ex: Livres Numériques',
                  'style': 'width: 100%; padding: 12px; border: 1px solid #E2E8F0; border-radius: 10px; outline: none;'
              }
          }) }}
          <div style="color: red; font-size: 0.8rem; margin-top: 5px;">
              {{ form_errors(form.name) }}
          </div>
        </div>

        {# Champ DESCRIPTION #}
        <div style="margin-bottom: 15px;">
          <label style="display: block; font-weight: 700; margin-bottom: 8px; font-size: 0.85rem;">Description</label>
          {{ form_widget(form.description, {
              'attr': {
                  'rows': '2',
                  'placeholder': 'Brève description...',
                  'style': 'width: 100%; padding: 12px; border: 1px solid #E2E8F0; border-radius: 10px; outline: none;'
              }
          }) }}
        </div>

        {# Champ ICON #}
        <div style="margin-bottom: 15px;">
          <label style="display: block; font-weight: 700; margin-bottom: 8px; font-size: 0.85rem;">Icône (FontAwesome class)</label>
          {{ form_widget(form.icon, {
              'attr': {
                  'placeholder': 'fas fa-book',
                  'style': 'width: 100%; padding: 12px; border: 1px solid #E2E8F0; border-radius: 10px; outline: none;'
              }
          }) }}
        </div>

        {# SÉLECTEUR DE COULEUR (Ton UI personnalisé) #}
        <div style="margin-bottom: 20px;">
          <label style="display: block; font-weight: 700; margin-bottom: 8px; font-size: 0.85rem;">Couleur du badge</label>

          <div style="display: flex; gap: 10px;">
            {% set colors = ['#6366F1', '#10B981', '#F59E0B', '#EF4444'] %}
            {% for c in colors %}
              <button
                type="button"
                class="color-btn"
                data-color="{{ c }}"
                style="
                  width: 30px;
                  height: 30px;
                  border-radius: 50%;
                  background: {{ c }};
                  cursor: pointer;
                  border: 2px solid white;
                  padding: 0;
                  box-shadow: {% if loop.first %}0 0 0 2px {{ c }}{% else %}none{% endif %};
                "
              ></button>
            {% endfor %}
          </div>
        </div>

        <button
          type="submit"
          class="btn btn-primary"
          style="width: 100%; background: #3B49A2; color: white; border:none; padding: 12px; border-radius: 10px; font-weight: bold; cursor: pointer;"
        >
          {{ is_edit is defined and is_edit ? 'Modifier' : 'Créer' }} la Catégorie
        </button>
        
      {{ form_end(form) }}
    </div>

    <div class="card" style="padding: 25px; background: #fff; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
      <h3 style="font-size: 1.1rem; font-weight: 800; margin-bottom: 20px;">Catégories Existantes</h3>

      <div style="display: flex; flex-direction: column; gap: 12px;">
        
        {# On vérifie si la variable categories existe #}
        {% if categories is defined and categories|length > 0 %}
            
            {% for cat in categories %}
              <div
                style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border: 1px solid #F1F5F9; border-radius: 12px; transition: 0.2s;"
                onmouseover="this.style.borderColor='{{ cat.color|default('#6366F1') }}'"
                onmouseout="this.style.borderColor='#F1F5F9'"
              >
                <div style="display: flex; align-items: center; gap: 12px;">
                  {# La couleur vient de la base de données #}
                  <div style="width: 12px; height: 12px; border-radius: 50%; background: {{ cat.color|default('#6366F1') }};"></div>
                  
                  <div style="display: flex; flex-direction: column;">
                      <span style="font-weight: 700; color: #1E293B;">
                        {# Affiche l'icône si elle existe #}
                        {% if cat.icon %}<i class="{{ cat.icon }}"></i>{% endif %}
                        {{ cat.name }}
                      </span>
                      {% if cat.description %}
                        <small style="color: #94a3b8; font-size: 0.8rem;">{{ cat.description|slice(0, 30) }}...</small>
                      {% endif %}
                  </div>
                </div>

                <div style="display: flex; gap: 8px;">
                  {# Bouton Modifier #}
                  <a href="{{ path('app_category_edit', {'id': cat.id}) }}" style="border: none; background: none; color: #64748B; cursor: pointer;">
                    <i class="fas fa-edit"></i>
                  </a>
                  
                  {# Bouton Supprimer #}
                  <form method="post" action="{{ path('app_category_delete', {'id': cat.id}) }}" onsubmit="return confirm('Êtes-vous sûr ?');" style="display:inline;">
                      <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ cat.id) }}">
                      <button type="submit" style="border: none; background: none; color: #EF4444; cursor: pointer;">
                        <i class="fas fa-trash"></i>
                      </button>
                  </form>
                </div>
              </div>
            {% endfor %}

        {% else %}
            <p style="color: #64748B; text-align: center;">Aucune catégorie trouvée.</p>
        {% endif %}
        
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block javascripts %}
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const input = document.getElementById('color-input');
    const buttons = document.querySelectorAll('.color-btn');

    if(input.value) {
        buttons.forEach(b => b.style.boxShadow = 'none');
        const activeBtn = document.querySelector(`.color-btn[data-color="${input.value}"]`);
        if(activeBtn) activeBtn.style.boxShadow = `0 0 0 2px ${input.value}`;
    }

    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        const color = btn.dataset.color;
        input.value = color;

        buttons.forEach(b => b.style.boxShadow = 'none');
        btn.style.boxShadow = `0 0 0 2px ${color}`;
      });
    });
  });
</script>
{% endblock %}
